# ============================================================================
# Netlify Configuration for Super Bowl Prediction App
# ============================================================================
#
# This configuration supports separate QA and Production databases using
# InstantDB. See MULTI_ENV_SETUP.md for detailed setup instructions.
#
# Quick Reference:
#   - Production branch: prod → uses Production database
#   - Other branches: master, feature/* → use QA database
#   - Environment variables: Set INSTANTDB_APP_ID in Netlify dashboard
#     or using Netlify CLI (recommended over storing in this file)
#

[build]
  # Build command injects environment variables into index.html
  command = "node build.js"
  # Publish the dist directory created by build script
  publish = "dist"

# ============================================================================
# Deploy Contexts - Different environments for different branches
# ============================================================================
#
# Netlify uses "contexts" to determine which environment you're deploying to:
#
#   1. PRODUCTION - Deploys from the prod branch
#      • Uses Production database (set INSTANTDB_APP_ID for production context)
#      • Live site for real users
#      • URL: https://your-site.netlify.app
#
#   2. BRANCH DEPLOY - Deploys from any other branch (master, feature/*, etc.)
#      • Uses QA database (set INSTANTDB_APP_ID for branch-deploy context)
#      • Testing and QA environment
#      • URL: https://master--your-site.netlify.app
#
#   3. DEPLOY PREVIEW - Deploys for pull requests
#      • Uses QA database (set INSTANTDB_APP_ID for deploy-preview context)
#      • Code review and testing
#      • URL: https://deploy-preview-123--your-site.netlify.app
#
# See: https://docs.netlify.com/site-deploys/overview/#deploy-contexts

# Production deployment from prod branch
[context.production]
  command = "node build.js"
  publish = "dist"

# Branch deploys (e.g., master → QA)
[context.branch-deploy]
  command = "node build.js"
  publish = "dist"

# Deploy previews (pull requests → QA)
[context.deploy-preview]
  command = "node build.js"
  publish = "dist"

# ============================================================================
# Environment Variables
# ============================================================================
#
# RECOMMENDED: Set environment variables in Netlify Dashboard or CLI
#   - Netlify Dashboard: Site configuration → Environment variables
#   - Netlify CLI: netlify env:set INSTANTDB_APP_ID "..." --context production
#
# This keeps sensitive values out of your repository and allows different
# values per deploy context without code changes.
#
# ALTERNATIVE: Set environment variables in this file (see examples below)
#   ⚠️  WARNING: Only use this if your repository is PRIVATE
#   ⚠️  App IDs in this file will be visible to anyone with repo access
#
# --- Example Configuration (commented out) ---
#
# Production context - Live database
# [context.production.environment]
#   INSTANTDB_APP_ID = "8b6d941d-edc0-4750-95ec-19660710b8d6"
#
# Branch deploy context - QA database
# [context.branch-deploy.environment]
#   INSTANTDB_APP_ID = "a1b2c3d4-5678-90ab-cdef-1234567890ab"
#
# Deploy preview context - QA database
# [context.deploy-preview.environment]
#   INSTANTDB_APP_ID = "a1b2c3d4-5678-90ab-cdef-1234567890ab"
#
# To use these examples:
#   1. Uncomment the sections above
#   2. Replace the App IDs with your actual InstantDB App IDs
#   3. Commit and push to your repository
#
# For detailed setup instructions, see: MULTI_ENV_SETUP.md

# ============================================================================
# Security Headers
# ============================================================================

# Security headers
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    X-XSS-Protection = "1; mode=block"
    Referrer-Policy = "strict-origin-when-cross-origin"

# Cache static assets
[[headers]]
  for = "*.html"
  [headers.values]
    Cache-Control = "public, max-age=0, must-revalidate"

# Redirect rules (if needed in the future)
# [[redirects]]
#   from = "/old-path"
#   to = "/new-path"
#   status = 301
